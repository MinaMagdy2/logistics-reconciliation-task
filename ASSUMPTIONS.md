# Assumptions and Design Choices

This document outlines the key assumptions and interpretations of the requirements made during the development of this program.

### 1. Data Normalization & De-duplication

-   **Order ID for De-duplication (Internal Key):** To robustly merge duplicate orders (e.g., "Ord-001" and "ord001"), an internal key is generated by converting the ID to uppercase and removing **all** non-alphanumeric characters (e.g., `ORD-001` -> `ORD001`). This key is used only for grouping and merging records.

-   **Order ID for Display (Final ID):** The final `orderId` that appears in all output files is normalized by trimming whitespace, converting to uppercase, and stripping non-alphanumerics from the start and end **only** (e.g., "ORD-002." -> `ORD-002`). This preserves the original format as much as possible for human readability and is used for all comparisons in the reconciliation phase.

-   **Zone Normalization:** The `zones.csv` map is applied to find and replace canonical zone names within the `city` and `zoneHint` fields. The matching is case-insensitive and respects word boundaries (`\b`) to prevent partial matches (e.g., to avoid matching "Giza" inside "Giza-Street").

-   **Duplicate Merging Logic:** When merging records with the same internal key, the program follows these rules:
    - It keeps the earliest `deadline`.
    - For all other fields, it fills any missing information from subsequent records. If a field is already populated, the data from the first record encountered is kept.

### 2. Planning Logic & Tie-Breakers

The courier assignment logic follows a strict order of operations, which is critical for deterministic output:

1.  **Order Processing Sequence:** Orders are processed sequentially, sorted by the **earliest deadline first**. This is the most important implicit tie-breaker and dictates the state of courier capacity for subsequent orders.

2.  **Courier Eligibility:** A courier is only considered eligible for an order if it satisfies all of the following constraints:
    - It covers the order's `city` or `zoneHint`. The check is flexible (`string.includes()`) to handle compound zone hints like "6th of October - El Montazah".
    - It accepts the order's `paymentType` (specifically for `COD`).
    - The order's `productType` is not in the courier's `exclusions` list.
    - The courier has enough **remaining daily capacity** to handle the order's weight.

3.  **Tie-Breaking Rules:** If multiple couriers are eligible for a single order, they are selected based on the following rules in strict, descending order of importance:
    1.  Lowest `priority` value (1 is better than 2).
    2.  Lowest current assigned load (by `totalWeight`).
    3.  Lexicographical (alphabetical) order of the `courierId`.

### 3. Reconciliation Logic

-   **Matching:** The reconciliation process consistently uses the "Display ID" normalization (defined in `task1_cleaner.js` and imported) to match orders between the `plan.json` and `log.csv`. This ensures consistency across the entire application.
-   **Overloaded Couriers:** A courier is flagged as overloaded if the sum of weights of the orders they **actually delivered** (as per `log.csv`) exceeds their `dailyCapacity`. The planned load is irrelevant for this specific check.
